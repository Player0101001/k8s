# Docker容器
## Docker环境搭建
### 配置yum源
mkdir /etc/yum.repos.d/bak
mv /etc/yum.repos.d/*.repo /etc/yum.repos.d/bak/

cat <<EOF > /etc/yum.repos.d/abc.repo
[baseos]
name = baseos
baseurl = file:///mnt/BaseOS/
gpgcheck = 0

[app]
name = app
baseurl = file:///mnt/AppStream/
gpgcheck = 0
EOF

yum clean all
yum repolist all
yum install -y vim net-tools bash-completion yum-utils

yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo

yum install -y docker-ce

[root@docker ~]# docker -v
Docker version 25.0.4, build 1a576c5

[root@docker ~]# bash
[root@docker ~]# systemctl start docker.service
[root@docker ~]# systemctl enable docker.service

docker images

docker search mysql

docker pull centos
docker pull centos:7.8.2003

[root@docker ~]# docker pull mysql
[root@docker ~]# docker images
REPOSITORY   TAG        IMAGE ID       CREATED       SIZE
mysql        latest     019814493c7a   7 weeks ago   632MB
centos       latest     5d0da3dc9764   2 years ago   231MB
centos       7.8.2003   afb6fca791e0   3 years ago   203MB

[root@docker ~]# docker rmi centos
Error response from daemon: No such image: centos:latest

[root@docker ~]# docker rmi centos:7.8.2003
Untagged: centos:7.8.2003
Untagged: centos@sha256:8540a199ad51c6b7b51492fa9fee27549fd11b3bb913e888ab2ccf77cbb72cc1
Deleted: sha256:afb6fca791e071c66276202f8efca5ce3d3dc4fb218bcddff1bc565d981ddd1e
Deleted: sha256:fb82b029bea0a2a3b6a62a9c1e47e57fae2a82f629b2d1a346da4fc8fb53a0b6
[root@docker ~]# docker images
REPOSITORY   TAG       IMAGE ID       CREATED       SIZE
mysql        latest    019814493c7a   7 weeks ago   632MB
[root@docker ~]#
[root@docker ~]# docker rmi mysql
[root@docker ~]# docker rmi $(docker images -qa)

[root@docker ~]# docker save mysql:latest -o mysql.tar
[root@docker ~]# ls
anaconda-ks.cfg  mysql.tar
[root@docker ~]# docker images
REPOSITORY   TAG       IMAGE ID   CREATED   SIZE
[root@docker ~]#
[root@docker ~]# docker load -i mysql.tar
18a3ada103a9: Loading layer  118.8MB/118.8MB
96549124ed74: Loading layer  11.26kB/11.26kB
331304b328ea: Loading layer  2.359MB/2.359MB
7d05fbfb31ee: Loading layer  13.85MB/13.85MB
d8fb47b60f94: Loading layer  6.656kB/6.656kB
a5d9662dde43: Loading layer  3.072kB/3.072kB
7fafcf5c6ac1: Loading layer    201MB/201MB
ec9a59df23f2: Loading layer  3.072kB/3.072kB
5458227f9e0f: Loading layer  312.7MB/312.7MB
14544546851f: Loading layer   16.9kB/16.9kB
Loaded image: mysql:latest
[root@docker ~]# docker images
REPOSITORY   TAG       IMAGE ID       CREATED       SIZE
mysql        latest    019814493c7a   7 weeks ago   632MB


cat <<EOF > /etc/docker/daemon.json
{
  "registry-mirrors": ["https://cc2d8woc.mirror.aliyuncs.com"]
}
EOF

systemctl daemon-reload
systemctl restart docker

[root@docker ~]# docker images
REPOSITORY   TAG       IMAGE ID       CREATED       SIZE
alpine       latest    05455a08881e   6 weeks ago   7.38MB
[root@docker ~]# docker login --username=clis*****@126.com registry.cn-hangzhou.aliyuncs.com
Password:
WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded


[root@docker ~]# docker tag alpine:latest registry.cn-hangzhou.aliyuncs.com/20240310/alpine:v666
[root@docker ~]# docker push registry.cn-hangzhou.aliyuncs.com/20240310/alpine:v666
[root@docker ~]# docker pull registry.cn-hangzhou.aliyuncs.com/20240310/alpine:v666

docker ps
docker ps -a

[root@docker ~]# docker run centos:latest
[root@docker ~]# docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
[root@docker ~]# docker ps -a
CONTAINER ID   IMAGE           COMMAND       CREATED          STATUS                      PORTS     NAMES
573fc0035af6   centos:latest   "/bin/bash"   25 seconds ago   Exited (0) 24 seconds ago             magical_rubin


[root@docker ~]# docker run -t centos:latest
[root@b2bac161d8c1 /]# ls

[root@docker ~]# docker rm -f b

[root@docker ~]# docker run -t -i centos:latest 
[root@0f1e3a59c7f5 /]# ls
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
[root@0f1e3a59c7f5 /]# cd /tmp/ 
[root@0f1e3a59c7f5 tmp]# ls

[root@0f1e3a59c7f5 ~]# exit
exit
[root@docker ~]# docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
[root@docker ~]# docker ps -a
CONTAINER ID   IMAGE           COMMAND       CREATED              STATUS                      PORTS     NAMES
0f1e3a59c7f5   centos:latest   "/bin/bash"   About a minute ago   Exited (0) 11 seconds ago             ecstatic_boyd
